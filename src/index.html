<!doctype html>
<html>
<head>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js'></script>
</head>
<body>
<div id="message">Veuillez scanner</div>
<div id="registration" style="opacity: 0">
    <div><p id="badge"></p></div>
    <form action="#" method="post" name="registration" id="form_registration" class="form_class" >
        <label for="firstname">Prenom :</label>
        <input type="text" name="firstname" id="firstname" placeholder="Prenom" />
        <label for="lastname">Nom :</label>
        <input type="text" name="lastname" id="lastname" placeholder="Nom" />
        <button type="button" onclick="register()">Save</button>
    </form>
</div>

<script>
    const wss = new WebSocket('ws://localhost:3000');

    wss.onopen = (event) => {};

    wss.onmessage = (event) => {
        let msg = JSON.parse(event.data);
        switch (msg.type) {
            case 'data':
                document.getElementById("message").innerHTML = "Veuillez vous enregistrer";
                document.getElementById("badge").innerHTML = msg.data;
                document.getElementById('registration').style.opacity = "100%";
                break;
            case 'user' :
                document.getElementById("message").innerHTML = "Bienvenue " + msg.data.firstname + " " +  msg.data.lastname;
                break;
            case 'ok':
                document.getElementById("message").innerHTML = "Veuillez scanner";
                break;


        }
    }

    function register() {
        const firstname = document.getElementById("firstname").value;
        const lastname = document.getElementById("lastname").value;
        const badge = document.getElementById("badge").innerHTML;
        const data = {firstname: firstname, lastname: lastname, badge: badge};
        wss.send(JSON.stringify({type: 'registration', data: data}))
        document.getElementById('registration').style.opacity = "0";
        document.getElementById("message").innerHTML = "Veuillez scanner";

        document.getElementById("firstname").value = "";
        document.getElementById("lastname").value = "";

    }



</script>

</body>
</html>